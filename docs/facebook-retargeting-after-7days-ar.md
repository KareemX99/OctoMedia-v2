# فيسبوك ماسنجر — إعادة استهداف العملاء بعد 7 أيام (تأكيد السياسات + خطة تنفيذ عملية)

## TL;DR (مختصر مهم)
- **نعم، طبيعي جدًا إن الإرسال بالـ Message Tags يوقف أو يترفض** بعد تحديثات Meta لو الاستخدام تسويقي أو خارج الشروط.
- **لا يوجد حل “عضلي” 100% لإرسال رسائل ترويجية مجانًا لأي عميل بعد 7 أيام** عبر Send API.
- الحلول التي تشتغل بشكل متوافق (compliant) ومستقرة:
  1) **Sponsored Messages** (مدفوع)
  2) **إعادة فتح نافذة الـ 24 ساعة** عبر Click-to-Messenger/Ads أو أي تفاعل جديد من العميل
  3) **Opt-in channels** المعتمدة (حسب توفرها/موافقتها في حسابك)

---

## 1) تأكيد المعلومة: هل Message Tags “اتوقفت”؟

الأدق: **لم تختفِ بالكامل**، لكن Meta شددت جدًا على الاستخدام:
- الـ Tags مخصصة لحالات محددة (غالبًا non-promotional أو service updates).
- الاستخدام التسويقي/البروموشنال خارج نافذة الرسائل العادية يتعرض للرفض (أكواد أخطاء نافذة/سياسة).
- `HUMAN_AGENT` ليست بديلًا آمنًا لحملات التسويق الجماعي.

**النتيجة العملية:**
- لو هدفك “إعادة استهداف” عملاء قدامى برسائل عروض/بيع بعد 7 أيام → Message Tags غالبًا لن تكون قناة مضمونة.

---

## 2) ما الذي يعمل بنسبة ثابتة وملتزمة للريتارجت بعد 7 أيام؟

## A) Sponsored Messages (أفضل خيار للريتارجت التسويقي)
- تستهدف أشخاص **فتحوا محادثة مع الصفحة قبل كدا**.
- تعمل خارج نافذة 24 ساعة لأنها قناة إعلانية مدفوعة ومصرح بها لهذا السيناريو.
- مناسبة جدًا لسيناريو “رجّع العملاء القدامى”.

## B) إعادة فتح نافذة 24 ساعة أولًا
- شغّل Click-to-Messenger ads / CTA يخلّي العميل يبعث رسالة جديدة.
- بعد رد العميل، تفتح لك نافذة 24 ساعة للإرسال العادي (`RESPONSE`).
- ممتازة لو عايز تخفض تكلفة Sponsored وتجمع intent حقيقي.

## C) قنوات Opt-in (عند التوفر والموافقة)
- أي قناة رسمية تعتمد opt-in صريح وتسمح بنوع الإشعار المطلوب.
- استخدمها فقط وفق سياسة المنتج المعتمدة في حسابك (مش workaround).

---

## 3) ما الذي يجب إيقاف الاعتماد عليه فورًا؟

1. **الافتراض أن Message Tag يضمن التسويق بعد 7 أيام**.
2. **Fallback تلقائي بين عدة Tags** كأنه bypass.
3. **الاعتماد على Browser Automation/Puppeteer** كحل دائم للإرسال التسويقي في ماسنجر.

هذه الأساليب قد تعمل مؤقتًا لبعض الحالات لكنها **غير مضمونة** ومخاطرتها عالية (قيود/حظر/انخفاض deliverability).

---

## 4) خطة تعديل عملية داخل OctoMedia (تنفيذ واضح)

## Phase 1 — Policy-Safe Guardrails (سريع)
1. قسم الإرسال الجماعي إلى نوعين واضحين:
   - `marketing` (تسويقي)
   - `transactional` (خدمي/تحديثات مشروعة)
2. إن كان `marketing` وخارج 24 ساعة:
   - **لا ترسل عبر Message Tag**
   - أرجع نتيجة: `requiresSponsoredMessage=true`
3. الإرسال داخل 24 ساعة يكون `messaging_type: RESPONSE` بدون Tags.

## Phase 2 — Data Model
أضف حقول لكل مستلم:
- `lastUserInteractionAt`
- `lastWindowType` (`24h_open` / `closed`)
- `marketingOptInStatus` (إن وجد رسميًا)
- `channelEligibility` (api / sponsored / blocked)

## Phase 3 — UI/UX
في شاشة الإرسال الجماعي:
- أظهر 3 أعداد:
  - `داخل 24 ساعة`
  - `خارج 24 ساعة (يحتاج Sponsored)`
  - `غير مؤهل`
- زر CTA واضح: **“إنشاء جمهور Sponsored Messages”**
- تنبيه صريح قبل الإرسال: “العملاء خارج النافذة لن يُرسل لهم عبر API العادي”.

## Phase 4 — Reporting
- Dashboard للـ deliverability حسب الفئة:
  - response_24h_success
  - tag_rejected_policy
  - sponsored_sent
- ده يمنع تكرار حملات غير متوافقة.

---

## 5) توصية مباشرة لحالتك الآن

لو هدفك: “أستهدف كل اللي كلم الصفحة حتى لو مر أكثر من 7 أيام” بشكل مضمون:
1) استخدم **Sponsored Messages** كقناة retargeting الأساسية.
2) واستخدم broadcast API فقط لمن داخل نافذة التفاعل المسموح بها.
3) ابنِ workflow هجينة:
   - حملة إعلانية تعيد فتح المحادثة
   - ثم automation داخل 24 ساعة.

هذا أقرب نموذج “مضمون تشغيليًا + متوافق سياساتيًا”.

---

## 6) Checklist تنفيذ سريعة للفريق
- [ ] إضافة `campaignType` (`marketing|transactional`)
- [ ] تعديل منطق الإرسال داخل/خارج 24 ساعة
- [ ] منع fallback غير المتوافق للـ marketing
- [ ] إضافة تصنيف مستلمين policy-aware في واجهة broadcast
- [ ] إضافة export للجمهور الخارجي لاستخدامه في Sponsored Messages
